# Development

This document covers the development setup, build process, and project structure for Penpot Wizard.

## Prerequisites

- Node.js 18+
- npm or yarn

## Quick Start

```bash
git clone <repository-url>
cd penpot-wizard
npm install
```

## Scripts

| Command | Purpose |
|---------|---------|
| `npm run dev` | UI development mode (browser only, no Penpot) |
| `npm run dev:penpot` | Build plugin + watch UI for Penpot development |
| `npm run build` | Production build (plugin + UI) |
| `npm run preview` | Preview production build |
| `npm run test` | Run tests (Vitest) |
| `npm run test:ui` | Run tests with Vitest UI |
| `npm run lint` | Run ESLint |

## Build Process

Two build configurations:

1. **Plugin build** (`vite.config.plugin.js`):
   - Entry: `src/plugin/plugin.js`
   - Output: `dist/plugin.js`
   - Format: IIFE (runs in Penpot context)

2. **UI build** (`vite.config.js`):
   - Entry: `src/main.jsx`
   - Output: `dist/index.html` + assets
   - Format: ES modules
   - Runs in iframe

## Project Structure

```
penpot-wizard/
├── src/
│   ├── assets/           # Agents and tools
│   │   ├── directorAgents.js
│   │   ├── coordinatorAgents.js
│   │   ├── specializedAgents.js
│   │   ├── imageGenerationAgents.js
│   │   ├── functionTools.js
│   │   ├── ragTools.js
│   │   ├── toolsCreateShapes.js
│   │   ├── toolsModifyShapes.js
│   │   ├── toolsCompoundShapes.js
│   │   ├── toolsLayoutShapes.js
│   │   ├── toolsInteractions.js
│   │   ├── toolsFlows.js
│   │   ├── toolsReorderShapes.js
│   │   ├── toolsTokens.js
│   │   ├── iconsTool.js
│   │   └── tools.js      # Barrel export
│   ├── components/       # React UI
│   │   ├── Chat/
│   │   ├── LeftSidebar/
│   │   └── SettingsForm/
│   ├── plugin/           # Penpot plugin code
│   │   ├── plugin.js
│   │   ├── mainHandlers.js
│   │   ├── drawHandlers/ # Shape, token, layout, interaction handlers
│   │   │   ├── index.js
│   │   │   ├── shapeHandlers.js
│   │   │   ├── tokenHandlers.js
│   │   │   └── ...
│   │   └── utils.js
│   ├── stores/           # Nanostores state
│   │   ├── directorAgentsStore.js
│   │   ├── specializedAgentsStore.js
│   │   ├── toolsStore.js
│   │   ├── settingsStore.js
│   │   └── ...
│   ├── types/             # TypeScript-like types
│   │   ├── types.js
│   │   ├── shapeTypes.js
│   │   ├── shapeTypesSupport.js
│   │   └── tokensTypes.js
│   └── utils/
│       ├── pluginUtils.js
│       ├── ragUtils.js
│       ├── modelUtils.js
│       └── ...
├── public/               # Static assets (manifest, icon, RAG .zip files)
├── dist/                 # Build output
└── docs/                 # Documentation
```

## Testing

Tests use Vitest. Run:

```bash
npm run test
```

For interactive UI:

```bash
npm run test:ui
```

Tests are located in `src/**/__tests__/*.test.js`.

## Environment and Configuration

- **API keys**: Stored in browser localStorage via Settings UI (no `.env` required for runtime)
- **RAG databases**: Place `.zip` files in `public/` (generated by orama-persistence-generator)

## Key Dependencies

- `ai` – Vercel AI SDK
- `@ai-sdk/openai`, `@openrouter/ai-sdk-provider` – LLM providers
- `@orama/orama` – Vector search for RAG
- `nanostores` – State management
- `@penpot/plugin-types` – Penpot plugin types
- `zod` – Schema validation

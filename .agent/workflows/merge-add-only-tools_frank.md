# ---

# description: Merge a feature branch into tools_frank using a temporary patch (add‑only)

# ---

**Goal**: Incorporate a feature branch that **only adds new files or code** into `tools_frank` while avoiding any deletions or modifications. This mirrors the previous approach where we generated temporary patch files and applied them.

## Prerequisites

- Clean working tree on `tools_frank` (no uncommitted changes).
- The feature branch is based on the latest `tools_frank` (or you will rebase it).
- Git is installed and you have push rights.

## Workflow Steps

1. **Checkout `tools_frank` and update**
   ```bash
   // turbo
   git checkout tools_frank
   // turbo
   git pull origin tools_frank
   ```
2. **Create a temporary branch from the feature branch** (optional but keeps `tools_frank` untouched while we generate the patch)
   ```bash
   // turbo
   git checkout -b temp‑merge‑branch <source_branch>
   ```
3. **Generate a patch containing _only added_ files**
   ```bash
   // turbo
   git diff --diff-filter=A --binary tools_frank...temp‑merge‑branch > /tmp/additions.patch
   ```
   - `--diff-filter=A` keeps only additions.
   - `--binary` ensures new binary assets are included.
4. **Return to `tools_frank`**
   ```bash
   // turbo
   git checkout tools_frank
   ```
5. **Apply the patch**
   ```bash
   // turbo
   git apply --index /tmp/additions.patch
   ```
   - `--index` stages the changes ready for commit.
6. **Verify that no non‑addition changes slipped in**
   ```bash
   // turbo
   git diff --name-status | grep -E "^[MD]" && {
       echo "Error: Unexpected modifications or deletions detected. Abort."; exit 1;
   }
   echo "Add‑only verification passed."
   ```
7. **Commit the added files**
   ```bash
   // turbo
   git commit -m "Add feature <source_branch> (add‑only)"
   ```
8. **Run the project's test suite**
   ```bash
   // turbo
   npm install
   // turbo
   npm test
   ```
   _If any test fails, abort and fix the feature branch before repeating._
9. **Push the updated `tools_frank`**
   ```bash
   // turbo
   git push origin tools_frank
   ```
10. **Cleanup** – delete the temporary branch and optionally the feature branch
    ```bash
    // turbo
    git branch -D temp‑merge‑branch
    // turbo
    # Optional: delete the feature branch if no longer needed
    # git branch -d <source_branch>
    # git push origin --delete <source_branch>
    ```

## Important Notes

- The **patch generation step (3)** guarantees that only new files/content are captured. Any attempt to modify existing files will be ignored by the `--diff-filter=A` flag.
- The **verification step (6)** is a safety net; it aborts the workflow if any `M` (modified) or `D` (deleted) entries appear after applying the patch.
- Replace `<source_branch>` with the actual name of the branch you want to merge.
- This workflow mirrors the previous “temp‑file” approach you used for the horizontal‑flip merge.

---

_Generated by Antigravity – add‑only merge workflow using temporary patch files._
